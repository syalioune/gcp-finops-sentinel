<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:o="urn:schemas-microsoft-com:office:office">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!--[if mso]>
    <style type="text/css">
        body, table, td {font-family: Arial, Helvetica, sans-serif !important;}
    </style>
    <![endif]-->
    <title>GCP Policy Action Event</title>
</head>
<body style="margin: 0; padding: 0; background-color: #f5f7fa; font-family: 'Segoe UI', Arial, sans-serif;">
    <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0" style="background-color: #f5f7fa;">
        <tr>
            <td align="center" style="padding: 20px 0;">
                <!-- Main Container -->
                <table role="presentation" width="600" cellspacing="0" cellpadding="0" border="0" style="background-color: #ffffff; max-width: 600px;">

                    <!-- Header -->
                    <tr>
                        <td style="background-color: {% if success %}#059669{% else %}#dc2626{% endif %}; color: #ffffff; padding: 40px 30px; text-align: center;">
                            <h1 style="margin: 0 0 10px 0; font-size: 28px; font-weight: 600; color: #ffffff;">
                                {% if success %}✅ Policy Action Completed{% else %}❌ Policy Action Failed{% endif %}
                            </h1>
                            <div style="font-size: 14px; text-transform: uppercase; letter-spacing: 1px; color: #ffffff;">FinOps Sentinel Event Notification</div>
                            <div style="display: inline-block; padding: 8px 20px; font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin-top: 10px; background-color: rgba(255, 255, 255, 0.2); color: #ffffff;">
                                {{ 'Success' if success else 'Failed' }}
                            </div>
                        </td>
                    </tr>

                    <!-- Status Banner -->
                    <tr>
                        <td style="padding: 40px 30px 0 30px;">
                            <table role="presentation" width="100%" cellspacing="0" cellpadding="20" border="0" style="background-color: {% if success %}#d1fae5{% else %}#fee2e2{% endif %}; border-left: 4px solid {% if success %}#10b981{% else %}#ef4444{% endif %};">
                                <tr>
                                    <td>
                                        <h2 style="margin: 0 0 10px 0; font-size: 20px; font-weight: 600; color: {% if success %}#065f46{% else %}#991b1b{% endif %};">
                                            {% if success %}Action Successfully Applied{% else %}Action Failed to Apply{% endif %}
                                        </h2>
                                        <p style="margin: 0; font-size: 14px; color: {% if success %}#047857{% else %}#b91c1c{% endif %};">
                                            {% if success %}
                                            The policy enforcement action has been successfully applied to your GCP resources.
                                            {% else %}
                                            The policy enforcement action could not be applied. Please review the error details below.
                                            {% endif %}
                                        </p>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>

                    <!-- Action Summary -->
                    <tr>
                        <td style="padding: 30px 30px 0 30px;">
                            <table role="presentation" width="100%" cellspacing="0" cellpadding="20" border="0" style="background-color: #f9fafb;">
                                <tr>
                                    <td>
                                        <div style="background-color: #3b82f6; color: #ffffff; padding: 6px 16px; font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 15px; display: inline-block;">
                                            {{ action_type }}
                                        </div>
                                        <div style="font-size: 16px; color: #374151; font-family: 'Courier New', monospace;">
                                            {{ resource_type }}/{% if details and details.display_name %}{{ details.display_name }} ({{ resource_id }}){% else %}{{ resource_id }}{% endif %}
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>

                    <!-- Event Details Section -->
                    <tr>
                        <td style="padding: 30px 30px 0 30px;">
                            <h3 style="margin: 0 0 15px 0; font-size: 18px; font-weight: 600; color: #1e3a8a; padding-bottom: 8px; border-bottom: 2px solid #e5e7eb;">Event Information</h3>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 0 30px;">
                            <!-- Event Info Cards -->
                            <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                                <!-- Timestamp -->
                                <tr>
                                    <td style="background-color: #f9fafb; padding: 15px; border-left: 4px solid #3b82f6; vertical-align: top;">
                                        <div style="font-size: 12px; text-transform: uppercase; color: #6b7280; margin-bottom: 5px;">TIMESTAMP</div>
                                        <div style="font-size: 15px; color: #1a1a1a; font-family: 'Courier New', monospace; word-break: break-all;">{{ timestamp }}</div>
                                    </td>
                                </tr>
                                <tr><td height="15"></td></tr>
                                <!-- Action Type -->
                                <tr>
                                    <td style="background-color: #f9fafb; padding: 15px; border-left: 4px solid #3b82f6; vertical-align: top;">
                                        <div style="font-size: 12px; text-transform: uppercase; color: #6b7280; margin-bottom: 5px;">ACTION TYPE</div>
                                        <div style="font-size: 15px; color: #1a1a1a; font-family: 'Courier New', monospace; word-break: break-all;">{{ action_type }}</div>
                                    </td>
                                </tr>
                                <tr><td height="15"></td></tr>
                                <!-- Resource Type -->
                                <tr>
                                    <td style="background-color: #f9fafb; padding: 15px; border-left: 4px solid #3b82f6; vertical-align: top;">
                                        <div style="font-size: 12px; text-transform: uppercase; color: #6b7280; margin-bottom: 5px;">RESOURCE TYPE</div>
                                        <div style="font-size: 15px; color: #1a1a1a; font-family: 'Courier New', monospace; word-break: break-all;">{{ resource_type }}</div>
                                    </td>
                                </tr>
                                <tr><td height="15"></td></tr>
                                <!-- Resource -->
                                <tr>
                                    <td style="background-color: #f9fafb; padding: 15px; border-left: 4px solid #3b82f6; vertical-align: top;">
                                        <div style="font-size: 12px; text-transform: uppercase; color: #6b7280; margin-bottom: 5px;">RESOURCE</div>
                                        <div style="font-size: 15px; color: #1a1a1a; font-family: 'Courier New', monospace; word-break: break-all;">
                                            {% if details and details.display_name %}
                                                {{ details.display_name }}<br><span style="font-size: 12px; color: #6b7280;">{{ resource_id }}</span>
                                            {% else %}
                                                {{ resource_id }}
                                            {% endif %}
                                        </div>
                                    </td>
                                </tr>
                                <tr><td height="15"></td></tr>
                                <!-- Organization -->
                                <tr>
                                    <td style="background-color: #f9fafb; padding: 15px; border-left: 4px solid #3b82f6; vertical-align: top;">
                                        <div style="font-size: 12px; text-transform: uppercase; color: #6b7280; margin-bottom: 5px;">ORGANIZATION</div>
                                        <div style="font-size: 15px; color: #1a1a1a; font-family: 'Courier New', monospace; word-break: break-all;">{{ organization_id }}</div>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>

                    <!-- Action Details -->
                    {% if details %}
                    <tr>
                        <td style="padding: 30px 30px 0 30px;">
                            <h3 style="margin: 0 0 15px 0; font-size: 18px; font-weight: 600; color: #1e3a8a; padding-bottom: 8px; border-bottom: 2px solid #e5e7eb;">Action Details</h3>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 0 30px;">
                            <table role="presentation" width="100%" cellspacing="0" cellpadding="20" border="0" style="background-color: #ffffff; border: 1px solid #e5e7eb;">
                                <tr>
                                    <td>
                                        <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                                            {% for key, value in details.items() %}
                                            {% if value is not none and key != 'error' %}
                                            <tr>
                                                <td style="padding: 12px 0; border-bottom: 1px solid #f3f4f6;">
                                                    <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                                                        <tr>
                                                            <td style="font-weight: 600; color: #4b5563; min-width: 140px; vertical-align: top;">
                                                                {{ key|title|replace('_', ' ') }}:
                                                            </td>
                                                            <td align="right" style="color: #1a1a1a; word-break: break-word;">
                                                                {% if value is string %}
                                                                    {{ value }}
                                                                {% elif value is sequence and value is not string %}
                                                                    {{ value|join(', ') }}
                                                                {% else %}
                                                                    {{ value }}
                                                                {% endif %}
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                            {% endif %}
                                            {% endfor %}
                                        </table>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    {% endif %}

                    <!-- Error Details -->
                    {% if details and details.error %}
                    <tr>
                        <td style="padding: 20px 30px;">
                            <table role="presentation" width="100%" cellspacing="0" cellpadding="20" border="0" style="background-color: #fee; border: 2px solid #fcc;">
                                <tr>
                                    <td>
                                        <h3 style="margin: 0 0 10px 0; color: #991b1b; font-size: 16px;">⚠️ Error Details</h3>
                                        <table role="presentation" width="100%" cellspacing="0" cellpadding="15" border="0" style="background-color: #ffffff;">
                                            <tr>
                                                <td style="color: #dc2626; font-size: 13px; line-height: 1.5; font-family: 'Courier New', monospace; word-break: break-word;">
                                                    {{ details.error }}
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    {% endif %}

                    <!-- Footer -->
                    <tr>
                        <td style="background-color: #f9fafb; padding: 30px; text-align: center; border-top: 1px solid #e5e7eb;">
                            <div style="font-size: 14px; color: #3b82f6; font-weight: 600; margin-bottom: 10px;">GCP FinOps Sentinel</div>
                            <div style="font-size: 12px; color: #6b7280; line-height: 1.8;">
                                This is an automated notification from your GCP policy enforcement system.<br>
                                Event tracking helps maintain audit compliance and operational visibility.
                            </div>
                        </td>
                    </tr>

                </table>
            </td>
        </tr>
    </table>
</body>
</html>
